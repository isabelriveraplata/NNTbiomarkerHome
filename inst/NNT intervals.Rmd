---
title: "NNT intervals"
author: "Santa Claus"
date: "March 20, 2015"
output: pdf_document
---

# Intervals for NNT given observations

```{r}
library("NNTbiomarker")
```


## Prospective study requirements
We suppose the test divides a sample of 40 patients into roughly 25% positive and 75% negative, and the estimates match the hoped-for values 2 and 30:
Suppose we have the following observations:
```{r}
nntPos=2
nntNeg=30
prev = 0.15
Nsample = 40
Npositives = 10
Nnegatives = 30
```
We derive the usual quantities:

```{r}

ppv = 1/nntPos
npv = 1 - 1/nntNeg
tp = round(10*ppv)
fn = round(10*(1-ppv))
tn = round(30*npv)
fp = round(30*(1-npv))

```
The observed predictive values would be `r ppv` and `r npv`. So there are `r tp` true positives, `r tn` true negatives. 

We set a confidence level of `r 2*(alpha <- 0.025)`,
To get 95% predictive intervals with a Jeffreys Beta(1/2, 1/2) prior, as follows:
```{r}
prior = c(1/2, 1/2)
ppvPI = qbeta(c(alpha, 1-alpha), 
                 tp+prior[1]-1, fn+prior[2]-1)
npvPI = qbeta(c(alpha, 1-alpha), 
                 tn+prior[1]-1, fp+prior[2]-1)
```

The Bayesian interval for positive predictive value
`r paste(round(100*ppvPI), "%", sep="", collapse="-")`
is almost identical to the standard exact frequentist confidence interval, 
`r paste(round(100*binom.confint(tp, Npositives)), "%", sep="", collapse="-")`.

The Bayesian interval for negative predictive value
`r paste(round(100*npvPI), "%", sep="", collapse="-")`
differs from the frequentist interval
`r paste(round(100*binom.confint(tn, Nnegatives)), "%", sep="", collapse="-")`.


QUOTED:
 would be 19% to 81% for PPV, and 83% to 100% for NPV, or equivalently[22] 1.23 to 5.35 for NNTPos, and 5.81 to 1180 for NNTNeg. 

## Retrospective study requirements
--

For example, if the estimates SN=18/22 = 82% and SP=34/40=85% are observed, then the corresponding confidence intervals will be 60%–95% for SN, and 70%–94% for SP, and Bayes predictive intervals will be (1.4, 2.7) for NNTPos , and (16.4, 87.8) for NNTNeg . (These intervals derive from assuming independent Jeffreys priors for SN and SP, sampling from joint independent posteriors incorporating the anticipated results, and applying Bayes theorem).
